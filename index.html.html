<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Tracker Militar – Renunțare Fumat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: Consolas, monospace;

     background-image: url('https://yandy.cachefly.net/HiRez/SA_FR8145_whtbck_frt1_2023SEPT.jpg');
background-size: contair;
background-repeat: space;
background-attachment: fixed;
      color: #f2f2f2;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    h1, h2, h3 {
      text-align: center;
      margin: 8px 0;
    }

    h1 {
      font-size: 20px;
      color: #0B3D2E;
      text-shadow: 0 0 6px #0f0;
    }

    h2 {
      font-size: 16px;
      color: #0B3D2E;
    }

    label {
      display: block;
      margin-top: 8px;
      font-size: 14px;
	  color: #000000;
    }

    select, button {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      background-color: #1F3B4D;
      color: #f2f2f2;
      border: 1px solid #29506B;
      border-radius: 4px;
      font-family: inherit;
      font-size: 14px;
    }

    button {
      cursor: pointer;
    }

    button:active {
      background-color: #29506B;
    }

    .info {
      margin-top: 12px;
      padding: 8px;
      border-radius: 4px;
      font-size: 14px;
      min-height: 40px;
    }

    .info.ok {
      background-color: #123015;
      color: #7CFC00;
      border: 1px solid #7CFC00;
    }

    .info.bad {
      background-color: #3b1111;
      color: #ff4c4c;
      border: 1px solid #ff4c4c;
    }

    .info.neutral {
      background-color: #1b2730;
      color: #f2f2f2;
      border: 1px solid #29506B;
    }

    .row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .row > div {
      flex: 1;
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      text-align: center;
    }

    .status.ok {
      color: #0B3D2E;
      text-shadow: 0 0 4px #0f0;
    }

    .status.bad {
      color: #ff4c4c;
      text-shadow: 0 0 4px #f00;
    }

    canvas {
      margin-top: 16px;
      width: 100%;
      background-color: #0b141a;
      border: 1px solid #29506B;
    }

    hr {
      border: none;
      border-top: 1px solid #29506B;
      margin: 16px 0;
    }

    .small {
      font-size: 12px;
      opacity: 0.8;
      text-align: center;
      margin-top: 8px;
    }
</style>
</head>
<body>
<div class="app">
  <h1>OPERATIUNEA: NEFUMĂTOR ÎN 20 DE ZILE</h1>
  <h2>Tracker Militar – Catalin</h2>

  <label for="daySelect">Ziua (1–20):</label>
  <select id="daySelect"></select>

  <label for="intervalSelect">Interval orar:</label>
  <select id="intervalSelect"></select>

  <div class="row">
    <div>
      <button id="loadIntervalsBtn">Încarcă intervalele</button>
    </div>
    <div>
      <button id="smokeBtn">Am fumat o țigară</button>
    </div>
  </div>

  <div class="row">
    <div>
      <button id="resetIntervalBtn">Reset interval</button>
    </div>
    <div>
      <button id="resetDayBtn">Reset zi</button>
    </div>
  </div>

  <div id="infoBox" class="info neutral">
    Alege ziua și intervalul, apoi apasă „Am fumat o țigară”.
  </div>

  <div id="dayStatus" class="status">Status zi: -</div>

  <hr />

  <button id="showGraphBtn">Grafic progres (permise vs. fumate)</button>
  <canvas id="graphCanvas" height="200"></canvas>

  <div class="small">
    Datele se salvează automat pe acest dispozitiv (localStorage).
  </div>
</div>

<script>
  // PLAN MILITAR – TIGĂRI PERMISE
  const plan = {
    1: { // Ziua 1 – Duminica
      "05-10": 3,
      "10-14": 3,
      "14-18": 3,
      "18-23": 3
    },
    ...Object.fromEntries(
      Array.from({length: 5}, (_, i) => {
        const day = 2 + i; // 2–6
        return [day, {
          "05-06": 2,
          "06-07:30": 3,
          "07:30-10": 1,
          "10-11": 2,
          "11-14": 1,
          "14-14:30": 2,
          "14:30-16:30": 1,
          "17-20": 1,
          "20-23": 1
        }];
      })
    ),
    ...Object.fromEntries(
      Array.from({length: 2}, (_, i) => {
        const day = 7 + i; // 7–8
        return [day, {
          "05-10": 3,
          "10-14": 3,
          "14-18": 3,
          "18-23": 3
        }];
      })
    ),
    ...Object.fromEntries(
      Array.from({length: 5}, (_, i) => {
        const day = 9 + i; // 9–13
        return [day, {
          "05-06": 1,
          "06-07:30": 2,
          "07:30-10": 1,
          "10-11": 1,
          "11-14": 1,
          "14-14:30": 1,
          "14:30-16:30": 0,
          "17-20": 1,
          "20-23": 1
        }];
      })
    ),
    ...Object.fromEntries(
      Array.from({length: 2}, (_, i) => {
        const day = 14 + i; // 14–15
        return [day, {
          "05-10": 2,
          "10-14": 2,
          "14-18": 2,
          "18-23": 2
        }];
      })
    ),
    ...Object.fromEntries(
      Array.from({length: 3}, (_, i) => {
        const day = 16 + i; // 16–18
        return [day, {
          "05-06": 1,
          "06-07:30": 1,
          "14-14:30": 1,
          "18-23": 1
        }];
      })
    ),
    ...Object.fromEntries(
      Array.from({length: 2}, (_, i) => {
        const day = 19 + i; // 19–20
        return [day, {
          "ALL DAY": 0
        }];
      })
    )
  };

  const STORAGE_KEY = "smoking_tracker_militar";

  function loadData() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      return JSON.parse(raw);
    } catch (e) {
      return {};
    }
  }

  function saveData(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  const data = loadData(); // { "day|interval": count }

  function key(day, interval) {
    return `${day}|${interval}`;
  }

  function getSmoked(day, interval) {
    return data[key(day, interval)] || 0;
  }

  function setSmoked(day, interval, value) {
    const k = key(day, interval);
    if (value <= 0) {
      delete data[k];
    } else {
      data[k] = value;
    }
    saveData(data);
  }

  const daySelect = document.getElementById("daySelect");
  const intervalSelect = document.getElementById("intervalSelect");
  const loadIntervalsBtn = document.getElementById("loadIntervalsBtn");
  const smokeBtn = document.getElementById("smokeBtn");
  const resetIntervalBtn = document.getElementById("resetIntervalBtn");
  const resetDayBtn = document.getElementById("resetDayBtn");
  const infoBox = document.getElementById("infoBox");
  const dayStatus = document.getElementById("dayStatus");
  const showGraphBtn = document.getElementById("showGraphBtn");
  const graphCanvas = document.getElementById("graphCanvas");
  const ctx = graphCanvas.getContext("2d");

  function initDaySelect() {
    Object.keys(plan).forEach(d => {
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = `Ziua ${d}`;
      daySelect.appendChild(opt);
    });
    daySelect.value = "1";
  }

  function loadIntervals() {
    const day = parseInt(daySelect.value, 10);
    const dayPlan = plan[day];
    if (!dayPlan) {
      setInfo("Alege o zi validă.", "bad");
      return;
    }
    intervalSelect.innerHTML = "";
    Object.keys(dayPlan).forEach(intv => {
      const opt = document.createElement("option");
      opt.value = intv;
      opt.textContent = intv;
      intervalSelect.appendChild(opt);
    });
    setInfo("Intervalele au fost încărcate.", "neutral");
    updateDayStatus();
  }

  function setInfo(text, type) {
    infoBox.textContent = text;
    infoBox.className = "info " + (type || "neutral");
  }

  function updateDayStatus() {
    const day = parseInt(daySelect.value, 10);
    const dayPlan = plan[day];
    if (!dayPlan) {
      dayStatus.textContent = "Status zi: -";
      dayStatus.className = "status";
      return;
    }
    let totalAllowed = 0;
    let totalSmoked = 0;
    for (const [intv, allowed] of Object.entries(dayPlan)) {
      totalAllowed += allowed;
      totalSmoked += getSmoked(day, intv);
    }
    if (totalSmoked <= totalAllowed) {
      dayStatus.textContent = `Status zi ${day}: ${totalSmoked} / ${totalAllowed} țigări (OK)`;
      dayStatus.className = "status ok";
    } else {
      dayStatus.textContent = `Status zi ${day}: ${totalSmoked} / ${totalAllowed} țigări (DEPĂȘIT)`;
      dayStatus.className = "status bad";
    }
  }

  function smoke() {
    const day = parseInt(daySelect.value, 10);
    const interval = intervalSelect.value;
    const dayPlan = plan[day];
    if (!dayPlan || !(interval in dayPlan)) {
      setInfo("Selectează ziua și intervalul.", "bad");
      return;
    }
    const allowed = dayPlan[interval];
    const current = getSmoked(day, interval) + 1;
    setSmoked(day, interval, current);

    if (current > allowed) {
      setInfo(`DEPĂȘIT! Ai voie ${allowed}, ai fumat ${current} în intervalul ${interval}.`, "bad");
    } else {
      setInfo(`OK. Ai fumat ${current} din ${allowed} în intervalul ${interval}.`, "ok");
    }
    updateDayStatus();
  }

  function resetInterval() {
    const day = parseInt(daySelect.value, 10);
    const interval = intervalSelect.value;
    const dayPlan = plan[day];
    if (!dayPlan || !(interval in dayPlan)) {
      setInfo("Selectează ziua și intervalul.", "bad");
      return;
    }
    setSmoked(day, interval, 0);
    setInfo(`Intervalul ${interval} a fost resetat.`, "neutral");
    updateDayStatus();
  }

  function resetDay() {
    const day = parseInt(daySelect.value, 10);
    const dayPlan = plan[day];
    if (!dayPlan) return;
    for (const intv of Object.keys(dayPlan)) {
      setSmoked(day, intv, 0);
    }
    setInfo(`Ziua ${day} a fost resetată.`, "neutral");
    updateDayStatus();
  }

  function drawGraph() {
    const days = Object.keys(plan).map(d => parseInt(d, 10)).sort((a,b)=>a-b);
    const allowedList = [];
    const smokedList = [];

    for (const day of days) {
      const dayPlan = plan[day];
      let totalAllowed = 0;
      let totalSmoked = 0;
      for (const [intv, allowed] of Object.entries(dayPlan)) {
        totalAllowed += allowed;
        totalSmoked += getSmoked(day, intv);
      }
      allowedList.push(totalAllowed);
      smokedList.push(totalSmoked);
    }

    const w = graphCanvas.width;
    const h = graphCanvas.height;
    ctx.clearRect(0, 0, w, h);

    const maxVal = Math.max(...allowedList, ...smokedList, 1);
    const padding = 20;
    const innerW = w - padding * 2;
    const innerH = h - padding * 2;

    function xPos(i) {
      if (days.length === 1) return padding + innerW / 2;
      return padding + (innerW * i) / (days.length - 1);
    }
    function yPos(val) {
      return padding + innerH - (val / maxVal) * innerH;
    }

    ctx.strokeStyle = "#29506B";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding, padding);
    ctx.lineTo(padding, padding + innerH);
    ctx.lineTo(padding + innerW, padding + innerH);
    ctx.stroke();

    function drawLine(values, color) {
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.beginPath();
      values.forEach((v, i) => {
        const x = xPos(i);
        const y = yPos(v);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
      ctx.fillStyle = color;
      values.forEach((v, i) => {
        const x = xPos(i);
        const y = yPos(v);
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    drawLine(allowedList, "#7CFC00");
    drawLine(smokedList, "#FF4C4C");

    ctx.fillStyle = "#f2f2f2";
    ctx.font = "10px Consolas";
    ctx.fillText("Permise (verde) vs. Fumate (roșu)", padding, padding - 5);
  }

  // Evenimente
  loadIntervalsBtn.addEventListener("click", loadIntervals);
  smokeBtn.addEventListener("click", smoke);
  resetIntervalBtn.addEventListener("click", resetInterval);
  resetDayBtn.addEventListener("click", resetDay);
  showGraphBtn.addEventListener("click", drawGraph);
  daySelect.addEventListener("change", () => {
    loadIntervals();
  });

  // Init
  initDaySelect();
  loadIntervals();
  drawGraph();
</script>
</body>
</html>